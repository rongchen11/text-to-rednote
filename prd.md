# 📱 文字转小红书 - 产品需求文档 (PRD)

## 🚀 版本更新历史

### v1.6.1 (2025-09-16)
**API密钥传递机制修复**

#### 产品需求更新
- **问题**：用户在设置中输入的API密钥无法正常使用，系统仍使用失效的默认密钥
- **解决方案**：修复API密钥传递链路，确保用户设置的密钥优先生效
- **用户价值**：用户可以正常使用自己的API密钥生成图片，避免"API密钥无效或已过期"错误

#### ASCII原型图 - API密钥传递流程
```
┌─────────────────────────────────────────────────────────────────┐
│                    用户设置API密钥流程                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [前端] 用户界面                                                │
│  ┌─────────────────┐                                           │
│  │   设置模态框     │  1. 用户输入API密钥                        │
│  │ [API密钥输入框]  │────────────────┐                         │
│  │ [保存] [测试]    │                │                         │
│  └─────────────────┘                │                         │
│                                      ▼                         │
│  ┌─────────────────┐       ┌──────────────────┐               │
│  │  API Client     │  2.   │   HTTP Request   │               │
│  │ setApiKey(key)  │────▶  │ Header:          │               │
│  │                 │       │ X-API-Key: xxx   │               │
│  └─────────────────┘       └──────────────────┘               │
│                                      │                         │
│                                      ▼                         │
│  [后端] API处理                                                │
│  ┌─────────────────────────────────────────┐                  │
│  │           API密钥获取优先级              │                  │
│  │                                         │                  │
│  │  1. req.headers['x-api-key'] ← 用户密钥  │ ✅ 新增           │
│  │  2. process.env.DOUBAO_API_KEY         │ ⚡ 现有           │
│  │  3. 返回错误提示                        │ ✅ 新增           │
│  │     (移除硬编码默认密钥)                 │ 🗑️ 删除          │
│  │                                         │                  │
│  └─────────────────────────────────────────┘                  │
│                                      │                         │
│                                      ▼                         │
│  ┌─────────────────┐                                          │
│  │   豆包API调用    │  3. 使用正确的API密钥                    │
│  │ Authorization:  │────▶ 🎨 生成图片成功                      │
│  │ Bearer {key}    │                                          │
│  └─────────────────┘                                          │
└─────────────────────────────────────────────────────────────────┘
```

#### 技术架构要点
1. **API密钥传递链路**：前端 → HTTP Header → 后端读取
2. **优先级机制**：用户密钥 > 环境变量 > 错误提示
3. **向下兼容**：保持现有环境变量配置机制
4. **错误处理**：提供明确的配置引导信息

#### 涉及文件修改
- `api/doubao-images.js` - 图片生成API
- `api/doubao-chat.js` - 文本处理API  
- 前端API客户端保持不变（已正确发送X-API-Key头）

---

### v1.4.0 (之前版本)
- 基础功能完善
- Vercel部署支持
- 批量图片生成

---

## 📋 核心功能需求

### 1. 文本智能拆分
- 基于AI语义理解将长文本拆分为封面和内容图片
- 封面：30-50字核心观点
- 内容图：每张50-100字，共3-8张

### 2. 模板系统
- 5种预设风格模板（简约、可爱、商务、生活、美食）
- 支持自定义模板创建

### 3. 图片生成
- 集成豆包API进行高质量图片生成
- 支持单张重新生成
- 批量生成和下载

### 4. 用户设置
- API密钥配置和管理
- 图片尺寸自定义
- 水印开关控制

---

## 🎯 产品目标
让博主能够一键将长文本转化为高质量的小红书图文内容，提升内容创作效率。

---

## 👥 目标用户
- 小红书博主和内容创作者
- 营销人员和品牌方
- 社交媒体运营人员