<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ”¯ä»˜è®¢å•è°ƒè¯•</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>æ”¯ä»˜è®¢å•è°ƒè¯•å·¥å…·</h1>
    <div id="result"></div>
    
    <script>
        // è¯·åœ¨è¿™é‡Œå¡«å…¥æ‚¨çš„Supabaseé…ç½®
        const SUPABASE_URL = 'your-supabase-url';
        const SUPABASE_ANON_KEY = 'your-supabase-anon-key';
        
        if (SUPABASE_URL.includes('your-supabase-url')) {
            document.getElementById('result').innerHTML = `
                <div style="color: red; padding: 20px; border: 1px solid red; margin: 20px;">
                    <h3>âš ï¸ éœ€è¦é…ç½®Supabase</h3>
                    <p>è¯·åœ¨æ­¤æ–‡ä»¶ä¸­å¡«å…¥æ‚¨çš„çœŸå®Supabaseé…ç½®ï¼š</p>
                    <ul>
                        <li>SUPABASE_URL: æ‚¨çš„Supabaseé¡¹ç›®URL</li>
                        <li>SUPABASE_ANON_KEY: æ‚¨çš„SupabaseåŒ¿åå¯†é’¥</li>
                    </ul>
                    <p>é…ç½®å®Œæˆååˆ·æ–°é¡µé¢æŸ¥çœ‹æ”¯ä»˜è®¢å•è®°å½•ã€‚</p>
                </div>
            `;
        } else {
            const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            
            async function checkPaymentOrders() {
                try {
                    const { data, error } = await supabase
                        .from('payment_orders')
                        .select('*')
                        .order('created_at', { ascending: false })
                        .limit(10);
                    
                    if (error) {
                        throw error;
                    }
                    
                    const resultDiv = document.getElementById('result');
                    
                    if (!data || data.length === 0) {
                        resultDiv.innerHTML = `
                            <div style="color: orange; padding: 20px; border: 1px solid orange; margin: 20px;">
                                <h3>ğŸ“‹ æœªæ‰¾åˆ°æ”¯ä»˜è®¢å•</h3>
                                <p>æ•°æ®åº“ä¸­æ²¡æœ‰æ”¯ä»˜è®¢å•è®°å½•ï¼Œè¿™å¯èƒ½è¯´æ˜ï¼š</p>
                                <ul>
                                    <li>æ”¯ä»˜è¯·æ±‚æ²¡æœ‰æˆåŠŸåˆ›å»ºè®¢å•</li>
                                    <li>å‰ç«¯æ”¯ä»˜æµç¨‹æœ‰é—®é¢˜</li>
                                    <li>æ•°æ®åº“è¿æ¥æœ‰é—®é¢˜</li>
                                </ul>
                            </div>
                        `;
                    } else {
                        let html = `
                            <div style="padding: 20px; border: 1px solid green; margin: 20px;">
                                <h3>âœ… æ‰¾åˆ° ${data.length} æ¡æ”¯ä»˜è®¢å•è®°å½•</h3>
                                <table border="1" style="width: 100%; border-collapse: collapse;">
                                    <tr>
                                        <th>è®¢å•å·</th>
                                        <th>é‡‘é¢</th>
                                        <th>ç§¯åˆ†</th>
                                        <th>çŠ¶æ€</th>
                                        <th>æ”¯ä»˜æ—¶é—´</th>
                                        <th>åˆ›å»ºæ—¶é—´</th>
                                    </tr>
                        `;
                        
                        data.forEach(order => {
                            html += `
                                <tr>
                                    <td>${order.out_trade_no}</td>
                                    <td>Â¥${order.amount}</td>
                                    <td>${order.credits}</td>
                                    <td style="color: ${order.status === 'paid' ? 'green' : order.status === 'pending' ? 'orange' : 'red'}">${order.status}</td>
                                    <td>${order.paid_at || 'æœªæ”¯ä»˜'}</td>
                                    <td>${order.created_at}</td>
                                </tr>
                            `;
                        });
                        
                        html += `
                                </table>
                                <div style="margin-top: 20px; padding: 10px; background: #f0f0f0;">
                                    <h4>ğŸ” åˆ†æç»“æœï¼š</h4>
                        `;
                        
                        const pendingOrders = data.filter(order => order.status === 'pending');
                        const paidOrders = data.filter(order => order.status === 'paid');
                        
                        if (pendingOrders.length > 0) {
                            html += `<p style="color: orange;">âš ï¸ æœ‰ ${pendingOrders.length} ä¸ªè®¢å•çŠ¶æ€ä¸ºpendingï¼Œè¯´æ˜æ”¯ä»˜å›è°ƒå¯èƒ½æ²¡æœ‰æ­£ç¡®å¤„ç†</p>`;
                        }
                        
                        if (paidOrders.length > 0) {
                            html += `<p style="color: green;">âœ… æœ‰ ${paidOrders.length} ä¸ªè®¢å•å·²æ”¯ä»˜ï¼Œä½†ç§¯åˆ†å¯èƒ½æ²¡æœ‰æ­£ç¡®å¢åŠ </p>`;
                        }
                        
                        html += `
                                </div>
                            </div>
                        `;
                        
                        resultDiv.innerHTML = html;
                    }
                    
                } catch (error) {
                    document.getElementById('result').innerHTML = `
                        <div style="color: red; padding: 20px; border: 1px solid red; margin: 20px;">
                            <h3>âŒ æŸ¥è¯¢å¤±è´¥</h3>
                            <p>é”™è¯¯ä¿¡æ¯: ${error.message}</p>
                            <p>å¯èƒ½çš„åŸå› ï¼š</p>
                            <ul>
                                <li>Supabaseé…ç½®ä¸æ­£ç¡®</li>
                                <li>æ•°æ®åº“è¡¨ä¸å­˜åœ¨</li>
                                <li>æƒé™é…ç½®é—®é¢˜</li>
                            </ul>
                        </div>
                    `;
                }
            }
            
            // é¡µé¢åŠ è½½åè‡ªåŠ¨æ£€æŸ¥
            checkPaymentOrders();
        }
    </script>
</body>
</html>
